{% extends "frame.html" %}
{% block content %}

<div class="progress mt-4">
    <div class="progress-bar" role="progressbar" style="width: 40%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<hr>

<h2 id="view-flows" class="pt-3 pb-3 mb-3 border-bottom">Step 2: Intercept Requests</h2>

<p>
    A powerful feature of mitmproxy is the interception of requests.
    An intercepted request is paused so that the user can edit (or discard) the request before sending it to the server.
    mitmproxy's <code>set intercept</code> command configures interceptions.
    The command is bound to shortcut <kbd>i</kbd> by default.
</p>

<p>
    Intercepting <em>all</em> requests is usually not desired as it constantly interrupts your browsing.
    Thus, mitmproxy expects a <a href="https://docs.mitmproxy.org/stable/concepts-filters/">flow filter expression</a> as the first argument to <code>set intercept</code> to selectively intercept requests.
    We want to intercept all requests to the <code>/vote/[cat|dog]</code> endpoint of the voting application.
    We use the flow filter <code>~u &lt;regex&gt;</code> that filters flows by matching the regular expressing on the URL of the request.
</p>

<ol>
    <li>Press <kbd>i</kbd> to prepopulate mitmproxy's command prompt with <code>set intercept ''</code>.</li>
    <li>Enter <kbd>~u /vote/</kbd> between the quotes of the <code>set intercept</code> command and press <kbd>ENTER</kbd>.</li>
    <!-- <li>Make sure you are in the default view of mitmproxy that shows all previous flows.</li> -->
    <li>Submit a vote in the voting app on the right.</li>
</ol>

<div class="asciinema-wrapper">
    <asciinema-player id="player" src="/static/ascii.cast" cols="112" rows="18" font-size="13px" poster="npt:0:14" preload>
        <strong>hi there</strong>
    </asciinema-player>
    <div class="annotation" data-from="1" data-to="5" style="left: 5%; top: 50%;">
        1. Start mitmproxy using the `mitmproxy` command
    </div>
    <div class="annotation" data-from="6" data-to="9" style="left: 20%; top: 70%;">
        2. generate some flows
    </div>
    <div class="annotation" data-from="10" data-to="13" style="left: 30%; top: 70%;">
        3. change currently focussed flow
    </div>
</div>

<p>
    You will see a new line in in the list of flows.
    It is colored in <span class="text-danger">red</span> to indicate that it is an intercepted flow:
</p>

<ol>
    <li>Put the focus (<code>&gt;&gt;</code>) on the intercepted flow.</li>
    <li>Press <kbd>a</kbd> to resume this flow without making any changes.</li>
    <li>Submit another vote to generate a new flow and focus it.</li>
    <li>Press <kbd>X</kbd> to kill, i.e., discard this flow without forwarding it to the server.</li>
</ol>

<p>
    In the next step, you will learn to modify intercepted flows before sending them to the server.
</p>

<hr>

<p class="d-flex">
    <a class="btn btn-outline-primary mr-sm-auto" href="/mitmproxy/user_interface" role="button">Previous Step: User Interface</a>
    <a class="btn btn-primary" href="/mitmproxy/modify_requests" role="button">Next Step: Modify Requests</a>
</p>

{% endblock %}
