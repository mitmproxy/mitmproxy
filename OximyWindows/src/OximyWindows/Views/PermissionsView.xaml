<UserControl x:Class="OximyWindows.Views.PermissionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="480" d:DesignWidth="380">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="24,32,24,0" HorizontalAlignment="Center">
            <!-- Shield Icon -->
            <Border Width="56" Height="56"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="28"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"
                    Margin="0,0,0,16">
                <TextBlock Text="&#xE72E;"
                           FontFamily="Segoe MDL2 Assets"
                           FontSize="24"
                           Foreground="{DynamicResource AccentBrush}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Border>

            <TextBlock Text="System Access Required"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"/>

            <TextBlock Text="Oximy needs these permissions to monitor AI traffic"
                       FontSize="13"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       TextAlignment="Center"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Permission Items -->
        <StackPanel Grid.Row="1" Margin="24,24,24,0">
            <!-- Certificate Permission -->
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="8"
                    Padding="16"
                    Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Status Icon -->
                    <Grid Grid.Column="0" Width="32" Height="32">
                        <ProgressBar x:Name="CertProgress"
                                     IsIndeterminate="True"
                                     Width="20" Height="20"
                                     Visibility="Collapsed"/>
                        <TextBlock x:Name="CertCheckmark"
                                   Text="&#xE73E;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="20"
                                   Foreground="{DynamicResource SuccessBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed"/>
                        <Ellipse x:Name="CertEmpty"
                                 Width="20" Height="20"
                                 Stroke="{DynamicResource BorderBrush}"
                                 StrokeThickness="2"/>
                    </Grid>

                    <!-- Text -->
                    <StackPanel Grid.Column="1" Margin="12,0">
                        <TextBlock Text="Security Certificate"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Required to inspect HTTPS traffic"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Grant Button -->
                    <Button x:Name="CertGrantButton"
                            Grid.Column="2"
                            Content="Install"
                            Style="{DynamicResource SecondaryButtonStyle}"
                            Width="70"
                            Click="CertGrantButton_Click"/>
                </Grid>
            </Border>

            <!-- Proxy Permission -->
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="8"
                    Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Status Icon -->
                    <Grid Grid.Column="0" Width="32" Height="32">
                        <ProgressBar x:Name="ProxyProgress"
                                     IsIndeterminate="True"
                                     Width="20" Height="20"
                                     Visibility="Collapsed"/>
                        <TextBlock x:Name="ProxyCheckmark"
                                   Text="&#xE73E;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="20"
                                   Foreground="{DynamicResource SuccessBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed"/>
                        <Ellipse x:Name="ProxyEmpty"
                                 Width="20" Height="20"
                                 Stroke="{DynamicResource BorderBrush}"
                                 StrokeThickness="2"/>
                    </Grid>

                    <!-- Text -->
                    <StackPanel Grid.Column="1" Margin="12,0">
                        <TextBlock Text="Network Proxy"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Route traffic through Oximy"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Grant Button -->
                    <Button x:Name="ProxyGrantButton"
                            Grid.Column="2"
                            Content="Enable"
                            Style="{DynamicResource SecondaryButtonStyle}"
                            Width="70"
                            IsEnabled="False"
                            Click="ProxyGrantButton_Click"/>
                </Grid>
            </Border>
        </StackPanel>

        <!-- Error Message -->
        <TextBlock x:Name="ErrorText"
                   Grid.Row="2"
                   Foreground="{DynamicResource ErrorBrush}"
                   FontSize="12"
                   TextAlignment="Center"
                   Margin="24,0,24,0"
                   TextWrapping="Wrap"
                   Visibility="Collapsed"/>

        <!-- Continue Button -->
        <Button x:Name="ContinueButton"
                Grid.Row="3"
                Content="Continue"
                Margin="24,16,24,24"
                HorizontalAlignment="Stretch"
                Style="{DynamicResource PrimaryButtonStyle}"
                IsEnabled="False"
                Click="ContinueButton_Click"/>
    </Grid>
</UserControl>
