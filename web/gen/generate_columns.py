#!/usr/bin/env python3

import json
import re
from pathlib import Path


def generate_columns():
    utils_path = Path("web/src/js/flow/utils.ts")

    with open(utils_path, "r") as file:
        content = file.read()

    match = re.search(r"export const sortFunctions = {([\s\S]*?)};", content)
    if not match:
        raise ValueError("Could not find sortFunctions in utils.ts")

    sort_functions_text = match.group(1)

    columns = re.findall(r"^\s*(\w+):", sort_functions_text, re.MULTILINE)

    output = f"""
# Auto-generated by generate_columns.py
AVAILABLE_WEB_COLUMNS  = {json.dumps(columns, indent=4)}

DEFAULT_COLUMNS = ['tls', 'icon', 'path', 'method', 'status', 'size', 'time']
"""

    output_path = Path("mitmproxy/tools/web/web_columns.py")
    with open(output_path, "w") as file:
        file.write(output.strip())

    print(f"Generated {output_path}")


if __name__ == "__main__":
    generate_columns()
