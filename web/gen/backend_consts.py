#!/usr/bin/env python3

import asyncio
import json
import textwrap
from pathlib import Path

from mitmproxy import version

here = Path(__file__).parent.absolute()

filename = here / "../src/js/backends/consts.ts"


async def make() -> str:
    data = {
        "version": version.VERSION,
    }

    # language=TypeScript
    content = (
        "/** Auto-generated by web/gen/backend_consts.py */\n"
        "export const BACKEND_CONSTS = %s\n"
        % textwrap.indent(json.dumps(data, indent=4, sort_keys=True), "    ").lstrip()
    )

    return content


if __name__ == "__main__":
    filename.write_bytes(asyncio.run(make()).encode())
