{
  "required": ["event_id", "timestamp", "source", "trace_level", "timing"],
  "properties": {
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "UUID v7 (time-sortable) unique identifier for this event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp with millisecond precision (e.g., 2026-01-11T20:33:29.904Z)"
    },
    "source": {
      "type": "object",
      "description": "Source of the AI interaction",
      "required": ["type", "id"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["api", "app", "website"],
          "description": "Type of source: api (direct API call), app (desktop application), website (browser-based)"
        },
        "id": {
          "type": "string",
          "description": "Identifier for the source (e.g., 'openai', 'granola', 'chatgpt')"
        },
        "endpoint": {
          "type": ["string", "null"],
          "description": "Specific endpoint or feature (e.g., 'chat', 'voice', 'code_gen')"
        },
        "referer": {
          "type": ["string", "null"],
          "description": "HTTP Referer header if present"
        },
        "origin": {
          "type": ["string", "null"],
          "description": "HTTP Origin header if present"
        }
      }
    },
    "trace_level": {
      "type": "string",
      "enum": ["full", "identifiable"],
      "description": "Level of detail: 'full' includes interaction data, 'identifiable' is metadata-only"
    },
    "timing": {
      "type": "object",
      "description": "Timing metrics for the request/response",
      "properties": {
        "duration_ms": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Total request duration in milliseconds"
        },
        "ttfb_ms": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Time to first byte in milliseconds"
        }
      }
    },
    "client": {
      "type": ["object", "null"],
      "description": "Information about the client process that made the request",
      "properties": {
        "port": {
          "type": "integer",
          "description": "Ephemeral port used for the connection"
        },
        "pid": {
          "type": ["integer", "null"],
          "description": "Process ID"
        },
        "name": {
          "type": ["string", "null"],
          "description": "Process name (e.g., 'curl', 'Granola')"
        },
        "path": {
          "type": ["string", "null"],
          "description": "Full path to the executable"
        },
        "ppid": {
          "type": ["integer", "null"],
          "description": "Parent process ID"
        },
        "parent_name": {
          "type": ["string", "null"],
          "description": "Parent process name (e.g., 'Cursor' for 'Cursor Helper')"
        },
        "user": {
          "type": ["string", "null"],
          "description": "Username running the process"
        },
        "bundle_id": {
          "type": ["string", "null"],
          "description": "macOS bundle identifier (e.g., 'com.apple.Safari', 'company.thebrowser.Browser')"
        }
      },
      "required": ["port"]
    },
    "interaction": {
      "type": ["object", "null"],
      "description": "Full interaction data (only present when trace_level is 'full')",
      "properties": {
        "type": {
          "type": "string",
          "description": "Interaction type (e.g., 'chat', 'completion', 'code_gen')"
        },
        "data": {
          "type": "object",
          "properties": {
            "model": {
              "type": ["string", "null"],
              "description": "AI model used (e.g., 'gpt-4', 'claude-3-opus')"
            },
            "request": {
              "type": "object",
              "description": "Parsed request data",
              "properties": {
                "prompt": {
                  "type": ["string", "null"],
                  "description": "Single prompt text (for simple request formats)"
                },
                "messages": {
                  "type": ["array", "null"],
                  "description": "Chat messages array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "role": {
                        "type": "string"
                      },
                      "content": {
                        "type": ["string", "null"]
                      }
                    }
                  }
                },
                "model": {
                  "type": ["string", "null"],
                  "description": "Model specified in request"
                }
              }
            },
            "response": {
              "type": "object",
              "description": "Parsed response data",
              "properties": {
                "content": {
                  "type": ["string", "null"],
                  "description": "Response content/completion text"
                },
                "model": {
                  "type": ["string", "null"],
                  "description": "Model that generated the response"
                }
              }
            }
          }
        }
      }
    },
    "subscription": {
      "type": ["object", "null"],
      "description": "User's subscription/plan information for the AI service",
      "properties": {
        "plan": {
          "type": ["string", "null"],
          "description": "Plan name or type (e.g., 'free', 'plus', 'pro', 'team')"
        }
      }
    }
  },
  "examples": [
    {
      "event_id": "019bb07a-d9ba-7cf4-8060-9316cb70d2ac",
      "timestamp": "2026-01-12T04:33:19.803Z",
      "source": {
        "type": "website",
        "id": "perplexity",
        "endpoint": "chat",
        "referer": "https://www.perplexity.ai/search/compare-methods-used-to-measur-YsIfWzfmQ5mVdQ_bLn4ROQ",
        "origin": "https://www.perplexity.ai"
      },
      "trace_level": "full",
      "timing": {
        "duration_ms": 2296,
        "ttfb_ms": 632
      },
      "client": {
        "port": 55979,
        "pid": 69754,
        "name": "Browser Helper",
        "path": "/Applications/Arc.app/Contents/Frameworks/ArcCore.framework/Helpers/Browser Helper.app/Contents/MacOS/Browser Helper",
        "ppid": 69731,
        "parent_name": "Arc",
        "user": "hirakdesai",
        "bundle_id": "company.thebrowser.Browser"
      },
      "interaction": {
        "type": "chat",
        "data": {
          "model": "turbo",
          "request": {
            "prompt": "hello",
            "model": "turbo"
          },
          "response": {
            "content": "Hello![1]\n\nGreat to see you back.[1]",
            "model": "turbo"
          }
        }
      },
      "subscription": {
        "plan": ""
      }
    }
  ]
}
